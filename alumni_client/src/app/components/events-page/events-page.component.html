<div class="events-container">

  <h2>ğŸ“ Alumni Events & Analytics Dashboard</h2>

  <!-- FILTER BAR -->
  <div class="filters">
    <!-- Year Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Year</mat-label>
      <mat-select [(value)]="filterYear" (selectionChange)="onFiltersChanged()">
        <mat-option value="all">All</mat-option>
        <mat-option *ngFor="let y of availableYears" [value]="y">{{ y }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Location Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Location</mat-label>
      <mat-select [(value)]="filterLocation" (selectionChange)="onFiltersChanged()">
        <mat-option value="all">All</mat-option>
        <mat-option *ngFor="let l of availableLocations" [value]="l">{{ l }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Graduation Year Filter -->
    <mat-form-field appearance="outline">
      <mat-label>Graduation Year</mat-label>
      <mat-select [(value)]="filterGradYear" (selectionChange)="onFiltersChanged()">
        <mat-option value="all">All</mat-option>
        <mat-option *ngFor="let g of availableGradYears" [value]="g">{{ g }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- KPI CARDS -->
  <div class="kpi-grid">
    <mat-card class="kpi purple">
      <div class="text">
        <h4>Total Events</h4>
        <h2>{{ kpiTotalEvents }}</h2>
      </div>
    </mat-card>

    <mat-card class="kpi blue">
      <div class="text">
        <h4>Total Attendees</h4>
        <h2>{{ kpiTotalAttendees }}</h2>
      </div>
    </mat-card>

    <mat-card class="kpi green">
      <div class="text">
        <h4>Unique Alumni</h4>
        <h2>{{ kpiUniqueAlumni }}</h2>
      </div>
    </mat-card>

    <mat-card class="kpi orange">
      <div class="text">
        <h4>Top Event</h4>
        <p>{{ kpiTopEvent }}</p>
      </div>
    </mat-card>
  </div>

  <!-- MAIN CHARTS (2 per row) -->
  <div class="charts">
    <mat-card>
      <h3>ğŸ§ Alumni Per Event</h3>
      <canvas id="chartUnique"></canvas>
    </mat-card>

    <mat-card>
      <h3>ğŸ“ Event Location Distribution</h3>
      <canvas id="chartLocations"></canvas>
    </mat-card>

    <mat-card>
      <h3>ğŸ¯ Attendees vs Speakers vs Volunteers</h3>
      <canvas id="chartParticipation"></canvas>
    </mat-card>

    <mat-card>
      <h3>ğŸ“† Events Organized Per Year</h3>
      <canvas id="chartEventsPerYear"></canvas>
    </mat-card>
  </div>

  <!-- YEAR-BASED CHARTS -->
  <div class="charts year-charts">
    <mat-card>
      <h3>ğŸ“ˆ Total Alumni Participation Per Year</h3>
      <canvas id="chartAttendeesPerYear"></canvas>
    </mat-card>

    <mat-card>
      <h3>ğŸ—£ Speakers vs Volunteers vs Attendees Per Year</h3>
      <canvas id="chartSVPerYear"></canvas>
    </mat-card>
  </div>

  <!-- ğŸ”® PREDICTIVE ANALYSIS SECTION -->
  <mat-card class="prediction-card">
    <h2>ğŸ”® Predictive Analysis</h2>

    <mat-accordion multi>

      <!-- Q1: Locations -->
      <mat-expansion-panel (opened)="renderPredictionCharts('p1')">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Which event locations are likely to attract the most alumni next year?
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="prediction-charts">
          <canvas id="forecastp1"></canvas>
          <canvas id="trendp1"></canvas>
        </div>

        <p class="prediction-text">
          {{ predictionTextP1 }}
        </p>
      </mat-expansion-panel>

      <!-- Q2: Graduation Batches -->
      <mat-expansion-panel (opened)="renderPredictionCharts('p2')">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Which graduation batches are expected to engage more in upcoming events?
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="prediction-charts">
          <canvas id="forecastp2"></canvas>
          <canvas id="trendp2"></canvas>
        </div>

        <p class="prediction-text">
          {{ predictionTextP2 }}
        </p>
      </mat-expansion-panel>

      <!-- Q3: Overall Growth -->
      <mat-expansion-panel (opened)="renderPredictionCharts('p3')">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Will overall alumni participation continue to grow over the next 3 years?
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="prediction-charts">
          <canvas id="forecastp3"></canvas>
          <canvas id="trendp3"></canvas>
        </div>

        <p class="prediction-text">
          {{ predictionTextP3 }}
        </p>
      </mat-expansion-panel>

    </mat-accordion>
  </mat-card>

</div>
